{% extends 'accounts/a_base.html' %}
{% load static %}
{% block title %}ãƒã‚¤ãƒšãƒ¼ã‚¸ - FamilyNote{% endblock %}
{% block content %}
<h2>ï½ãƒã‚¤ãƒšãƒ¼ã‚¸ï½</h2>


  {% if messages %}
    <div class="messages">
      {% for message in messages %}
        <div class="alert {{ message.tags }}">
          {{ message|safe }}
        </div>
      {% endfor %}
     </div>
  {% endif %}


<div class="box-container">
  <div class="profile-box">
    {% if user.image %}
      <img src="{{ user.profile_image_url }}" alt="ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒ" class="profile-image">
    {% else %}
      <img src="{% static 'accounts/images/default.png' %}" alt="ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆç”»åƒ"class="profile-image">
    {% endif %}
      <div class="profile-info">
        <p class="profile">åå‰: {{ user.full_name }}</p>
        <p class="profile">ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ : {{ user.nickname }}</p>
        <p class="profile">ã‚ãªãŸã®å®¶æ—: {{ user.family.family_name|default:"æœªæ‰€å±" }}</p>
      </div>
    <br>
    <a href="{% url 'accounts:user_edit' pk=user.id %}">ğŸ“ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ã‚’å¤‰æ›´ã™ã‚‹</a>
    <br>
    <a href="{% url 'accounts:password_change' %}">ğŸ”‘ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã™ã‚‹</a>
  </div>

  <div class="family-box">
    <div class="family-container">
      <h3>{{ user.family.family_name|default:"-" }} ãƒ¡ãƒ³ãƒãƒ¼ä¸€è¦§</h3>
      {% if family_members %}
        <table>
          <thead>
            <tr>
              <th>åå‰ / ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ </th>
            </tr>
          </thead>
          <tbody>
            {% for member in family_members %}
              <tr>
                <td>{{ member.full_name }} / {{ member.nickname }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <p>å®¶æ—ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</p>
      {% endif %}
      <div class="link-container">
      {% comment %} {% if not user.family %}
        <a href="#" id="open-family-modal">å®¶æ—ã‚’ä½œæˆã™ã‚‹</a>
      {% endif %}
        <a href="{% url 'families:leave_family' %}" id="leave-family-button" class="btn"
          {% if not user.family %}class="disabled-link" onclick="return false;"{% endif %}>
          å®¶æ—ã‚’æŠœã‘ã‚‹
        </a>
        <a href="{% url 'families:invite_family' %}" id="family-invite-link"
          {% if not user.family %}class="disabled-link" onclick="return false;"{% endif %}>
          å®¶æ—ã‚’æ‹›å¾…ã™ã‚‹
        </a>
      </div>
      {% if not user.family %}
        <p class="notice">â€» å®¶æ—ã‚’ä½œæˆã™ã‚‹ã“ã¨ã§ã€æ‹›å¾…ã‚„æŠœã‘ã‚‹ãƒœã‚¿ãƒ³ãŒæœ‰åŠ¹ã«ãªã‚Šã¾ã™</p>
      {% endif %} {% endcomment %}
        {% if user.family %}
          <a href="{% url 'families:leave_family' %}" id="leave-family-button" class="btn">
            å®¶æ—ã‚’æŠœã‘ã‚‹
          </a>
          <a href="{% url 'families:invite_family' %}" id="family-invite-link">
            å®¶æ—ã‚’æ‹›å¾…ã™ã‚‹
          </a>
        {% else %}
          <a href="#" id="open-family-modal">å®¶æ—ã‚’ä½œæˆã™ã‚‹</a>
        {% endif %}
      </div>
    </div>
  </div>
  
  
  <div id="family-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
    <span id="close-family-modal" class="close">&times;</span>
    <h3>å®¶æ—ã®ä½œæˆ</h3>
    <p style="font-size: 0.5em;">ä¾‹: å±±ç”°å®¶ã€YamadaFamily ãªã©ã‚°ãƒ«ãƒ¼ãƒ—åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</p>
      <form id="create-family-form" method="POST"> 
        {% csrf_token %}
        <label for="family_name">å®¶æ—ã®åå‰:</label>
        <input type="text" id="family_name" name="family.family_name" required>
        <br><br>
        <button type="submit" class="family-regist">ä½œæˆ</button>
      </form>
    </div>
  </div>


  <div class="child-box">
    <div class="child-container">
      <h3>{{ user.family.family_name|default:"-" }} ã“ã©ã‚‚ä¸€è¦§</h3>
        {% if children %}
          <ul id="child-list">
          <table>
            <colgroup>
              <col style="width: 100px;">
              <col style="width: 30px;">
            </colgroup>
            <thead>
              <tr>
                <th>åå‰ / ç”Ÿå¹´æœˆæ—¥</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
            {% for child in children %}
              <tr>
                <td>
                  <a href="#" class="edit-child" data-id="{{ child.id }}">{{ child.child_name }} / {{ child.birth_date|date:"Yå¹´mæœˆdæ—¥" }}</a>
                </td>
                <td>
                  <button class="delete-child" data-id="{{ child.id }}">å‰Šé™¤</button>
                </td>
              </tr>
            {% endfor %}
            </tbody>
          </table>
          </ul>
        {% else %}
          <p>ã“ã©ã‚‚ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</p>
        {% endif %}
      <div class="link-container">
        <a href="#" id="open-child-modal"
          {% if not user.family %}
            class="disabled-link"
            style="pointer-events: none; color: grey;"
          {% endif %}
        >ã“ã©ã‚‚ã‚’ç™»éŒ²ã™ã‚‹</a>
      </div>
    </div>
  </div>
    

  <div id="child-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
    <span id="close-child-modal" class="close">&times;</span>
    <h3>ã“ã©ã‚‚ã®ç™»éŒ²</h3>
      <form id="child-modal-form" method="POST" >
        {% csrf_token %}
        <label for="child_name">ã“ã©ã‚‚ã®åå‰:</label>
        <input type="text" id="child_name" name="child_name" required>
        <br><br>
        <label for="birth_date">ç”Ÿå¹´æœˆæ—¥:</label>
        <input type="date" id="birth_date" name="birth_date" required>
        <br><br>
        <button type="submit" class="child-regist">ç™»éŒ²</button>
      </form>
    </div>
  </div>

  <div id="edit-child-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
    <span id="close-edit-child-modal" class="close">&times;</span>
    <h3>ã“ã©ã‚‚æƒ…å ±ã®å¤‰æ›´</h3>
      <form id="edit-child-modal-form" method="POST">
        {% csrf_token %}
        <input type="hidden" id="edit_child_id" name="child_id">
        <label for="edit_child_name">ã“ã©ã‚‚ã®åå‰:</label>
        <input type="text" id="edit_child_name" name="child_name" required>
        <br><br>
        <label for="edit_birth_date">ç”Ÿå¹´æœˆæ—¥:</label>
        <input type="date" id="edit_birth_date" name="birth_date" required>
        <br><br>
        <button type="submit" id="submit-edit-button">å¤‰æ›´</button>
      </form>
    </div>
  </div> 
  
  <div id="delete-child-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
      <span id="close-delete-modal" class="close">&times;</span>
      <h3>ã“ã©ã‚‚æƒ…å ±ã®å‰Šé™¤</h3>
      <p>ã“ã©ã‚‚æƒ…å ±ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ<br>ç™»éŒ²ã—ãŸãŠãŸã‚ˆã‚Šã‚‚ä¸€ç·’ã«å‰Šé™¤ã•ã‚Œã¾ã™</p>
      <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
      <button id="confirm-delete" type="button">å‰Šé™¤</button>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
  <script src="{% static 'accounts/js/modal.js' %}"></script>
{% endblock %}
