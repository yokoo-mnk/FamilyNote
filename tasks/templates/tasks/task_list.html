<!DOCTYPE html>
{% load static %}
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}Noteä¸€è¦§ - FamilyNote{% endblock %}</title>
  <link rel="stylesheet" href="{% static 'tasks/css/t_style.css' %}">
</head>
<body class="task-list-page">
  <header>
    <div class="header">
      <h1>ï½FamilyNoteï½</h1>

      <form method="GET" action="{% url 'tasks:task_list' %}" class="search-bar">
        <input type="text" id="search" name="search" value="{{ search_query }}" placeholder="Noteã‚¿ã‚¤ãƒˆãƒ«ã¾ãŸã¯ãƒ¡ãƒ¢ã‚’æ¤œç´¢">
        <button type="submit">ğŸ”</button>
      </form>

      <nav class="custom-navbar">
        <a href="{% url 'tasks:home' %}">ãƒ›ãƒ¼ãƒ </a>
        <li class="dropdown">
          <a href="#" class="dropbtn">Note â–¼</a>
          <div class="dropdown-content">
            <a href="{% url 'tasks:task_list' %}">Noteä¸€è¦§</a>
            <a href="{% url 'tasks:task_create' %}">Noteç™»éŒ²</a>
          </div>
        </li>
        <li class="dropdown">
          <a href="#" class="dropbtn">ãŠãŸã‚ˆã‚Š â–¼</a>
          <div class="dropdown-content">      
            <a href="{% url 'school_letters:letter_list' %}">ãŠãŸã‚ˆã‚Šä¸€è¦§</a>
            <a href="{% url 'school_letters:create_letter' %}">ãŠãŸã‚ˆã‚Šç™»éŒ²</a>
          </div>
        </li>
        <a href="{% url 'accounts:mypage' %}">ãƒã‚¤ãƒšãƒ¼ã‚¸</a>
        {% if user.is_authenticated %}
          <form action="{% url 'accounts:logout' %}" method="post" class="logout-form">
            {% csrf_token %}
            <button type="submit" class="logout-btn">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
          </form>
        {% else %}
          <p>ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚</p>
        {% endif %}
      </nav>
    </div>
  </header>
  <main>
    <h4>{{ user.nickname }}ã•ã‚“ã€ä»Šæ—¥ã‚‚ãŠç–²ã‚Œã•ã¾ã§ã™ã€‚</h4>
    

  <form method="GET" action="{% url 'tasks:task_list' %}" class="category-filter">
    <div class="filter-item">
      <h2>Noteï½æˆ‘ãŒå®¶ã®è¨˜éŒ²ï½</h2>
      <label for="category">ã‚«ãƒ†ã‚´ãƒª:</label>
      <select name="category" id="category" onchange="this.form.submit()">
        <option value="">ã™ã¹ã¦</option>
        {% for value, label in categories %}
          <option value="{{ value }}" {% if selected_category == value %}selected{% endif %}>
            {{ label }}
          </option>
        {% endfor %}
      </select>
    </div>

    <div class="filter-item">
      <label for="is_favorite">ãŠæ°—ã«å…¥ã‚Š:</label>
      <select name="is_favorite" id="is_favorite" onchange="this.form.submit()">
        <option value="">ã™ã¹ã¦</option>
        <option value="only" {% if selected_is_favorite == 'only' %}selected{% endif %}>ãŠæ°—ã«å…¥ã‚Šã®ã¿è¡¨ç¤º</option>
      </select>
    </div>
  </form>

  <form method="post" action="{% url 'tasks:task_list' %}">
    <input type="hidden" id="home-task-remove-endpoint" value="/tasks/task_list_toggle_completion/">
    {% csrf_token %}
    <table>
      <colgroup>
        <col style="width: 30px;">  <!-- ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ -->
        <col style="width: 60px;"> <!-- æ—¥ä»˜ -->
        <col style="width: 60px;"> <!-- æ™‚é–“ -->
        <col style="width: 30px;">  <!-- ãŠæ°—ã«å…¥ã‚Š -->
        <col style="width: 150px;"> <!-- ã‚¿ã‚¤ãƒˆãƒ« -->
        <col style="width: 300px;"> <!-- ãƒ¡ãƒ¢ -->
        <col style="width: 120px;"> <!-- ç”»åƒ -->
        <col style="width: 50px;">  <!-- ç·¨é›† -->
        <col style="width: 50px;">  <!-- ã‚³ãƒ”ãƒ¼ -->
      </colgroup>
      <thead>
        <tr>
          <th></th>
          <th>æ—¥ä»˜</th>
          <th>æ™‚é–“</th>
          <th></th>
          <th>ã‚¿ã‚¤ãƒˆãƒ«</th>
          <th>ãƒ¡ãƒ¢</th>
          <th>ç”»åƒ</th>
          <th>ç·¨é›†</th>
          <th>ã‚³ãƒ”ãƒ¼</th>
        </tr>
      </thead>
      <tbody>
        {% for task in tasks %}
          <tr>
            <td class="check">
              <input type="checkbox" class="task-checkbox" name="tasks" value="{{ task.id }}" data-title="{{ task.title }}">
            </td>
            <td>{{ task.formatted_due_date }}</td>
            <td>
              {% if task.start_time %}
                {{ task.start_time }}
              {% else %}
                -
              {% endif %}
            </td>
            <td>
              {% if task.is_favorite %}
                  â­
              {% endif %}
            </td>
            <td>{{ task.title }}</td>
            <td class=memo>
              {% if task.memo %}
                {{ task.memo|linebreaksbr }}
              {% else %}
                -
              {% endif %}
            </td>
            <td>
              {% if task.image %}
                <img src="{{ task.image.url }}" alt="Task image" width="100">
              {% else %}
                -
              {% endif %}
            </td>
            <td class="edit">
              <a href="{% url 'tasks:task_edit' task.pk %}">ğŸ“</a>
            </td>
            <td class="copy">
              <a href="{% url 'tasks:task_copy_confirm' task.id %}">ğŸ“„</a>
            </td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="9">NoteãŒã‚ã‚Šã¾ã›ã‚“ã€‚</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>

    <!-- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ -->
    <div class="pagination">
      <span class="step-links">
      {% if page_obj.has_previous %}
        <a href="?page=1
          {% if request.GET.category %}&category={{ request.GET.category }}{% endif %}
          {% if request.GET.is_favorite %}&is_favorite=on{% endif %}
          {% if request.GET.search %}&search={{ request.GET.search }}{% endif %}">â‰ªæœ€åˆ
        </a>
        <a href="?page={{ page_obj.previous_page_number }}
          {% if request.GET.category %}&category={{ request.GET.category }}{% endif %}
          {% if request.GET.is_favorite %}&is_favorite=on{% endif %}
          {% if request.GET.search %}&search={{ request.GET.search }}{% endif %}">ï¼œå‰ã¸
        </a>
      {% endif %}

      <span class="current">
        ãƒšãƒ¼ã‚¸{{ page_obj.number }} / {{ page_obj.paginator.num_pages }}
      </span>

      {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}
          {% if request.GET.category %}&category={{ request.GET.category }}{% endif %}
          {% if request.GET.is_favorite %}&is_favorite=on{% endif %}
          {% if request.GET.search %}&search={{ request.GET.search }}{% endif %}">æ¬¡ã¸ï¼
        </a>
        <a href="?page={{ page_obj.paginator.num_pages }}
          {% if request.GET.category %}&category={{ request.GET.category }}{% endif %}
          {% if request.GET.is_favorite %}&is_favorite=on{% endif %}
          {% if request.GET.search %}&search={{ request.GET.search }}{% endif %}">æœ€å¾Œâ‰«
        </a>
      {% endif %}
      </span>
    </div>
    <input type="checkbox" id="select-all"> å…¨ã¦ã®é …ç›®ã‚’é¸æŠ
    <div class="footer-container">
      <button type="submit" name="action" value="show_on_home" class="todobtn">ãƒã‚§ãƒƒã‚¯ã—ãŸé …ç›®ã‚’<br>ToDoãƒªã‚¹ãƒˆã¸è¿½åŠ </button>
      <button type="button" id="delete-btn" name="action" value="delete" class="delete-btn">é¸æŠã—ãŸé …ç›®ã‚’å‰Šé™¤</button>
    </div>
  </form>

    <div id="delete-modal" class="modal-overlay" style="display: none;">
      <div class="modal-content">
        <span id="close-modal" class="close">&times;</span>
        <h3>ä»¥ä¸‹ã®Noteã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ</h3>
        <ul id="selected-tasks-list"></ul>
        <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
        <input type="hidden" id="task-delete-endpoint" value="{% url 'tasks:task_delete' %}">
        <button id="confirm-delete">å‰Šé™¤</button>
      </div>
    </div>
  </main> 
</body>
</html>


<script src="{% static 'tasks/js/modal.js' %}"></script>
