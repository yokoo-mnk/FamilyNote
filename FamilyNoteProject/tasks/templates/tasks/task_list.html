{% extends 'tasks/t_base.html' %}
{% block title %}Note一覧 - FamilyNote{% endblock %}
{% block content %}
<h2>Note～我が家の記録～</h2>
<button id="add_to_todolist">チェックした項目を<br>ToDoリストへ追加</button>

<form form class="no-box-form" method="post" action="{% url 'tasks:home' %}">
  {% csrf_token %}
  <table>
    <thead>
      <tr>
        <th></th>
        <th>カテゴリ</th>
        <th>日付</th>
        <th>時間</th>
        <th>タイトル</th>
        <th>メモ</th>
        <th>画像</th>
        <th>編集</th>
        <th>コピー</th>
      </tr>
    </thead>
    <tbody>
        {% for task in tasks %}
          <tr>
            <td>
              <input type="checkbox" name="tasks" value="{{ task.id }}" {% if task.id in request.session.selected_tasks %}checked{% endif %}>
            </td>
            <td>{{ task.get_category_display }}</td>
            <td>{{ task.formatted_due_date }}</td>
            <td>
              {% if task.start_time %}
                {{ task.start_time }}
              {% else %}
                -
              {% endif %}
            </td>
            <td>{{ task.title }}</td>
            <td>
              {% if task.memo %}
                {{ task.memo }}
              {% else %}
                -
              {% endif %}
            </td>
            <td>
              {% if task.image %}
                <img src="{{ task.image.url }}" alt="Task image" width="100">
              {% else %}
                -
              {% endif %}
            </td>
            <td>
              <a href="{% url 'tasks:task_edit' task.pk %}">📝</a>  <!-- 追加: 編集ボタン -->
            </td>
            <td>
              <a href="{% url 'tasks:task_copy' task.id %}">📄</a>
            </td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="5">タスクがありません。</td>
          </tr>
        {% endfor %}
    </tbody>
  </table>
</form>

<script>
document.getElementById('add_to_todolist').addEventListener('click', function() {
  var form = document.getElementById('task_form');
    form.submit();
});
</script>


  <!-- ページネーション -->
    <div>
      {% if tasks.has_previous %}
        <a href="?page=1">&laquo; 最初</a>
        <a href="?page={{ tasks.previous_page_number }}">前へ</a>
      {% endif %}
      <span>ページ {{ tasks.number }} / {{ tasks.paginator.num_pages }}</span>
      {% if tasks.has_next %}
        <a href="?page={{ tasks.next_page_number }}">次へ</a>
        <a href="?page={{ tasks.paginator.num_pages }}">最後 &raquo;</a>
      {% endif %}
    </div>
{% endblock %}