<!DOCTYPE html>
{% load static %}
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}Noteä¸€è¦§ - FamilyNote{% endblock %}</title>
  <link rel="stylesheet" href="{% static 'tasks/css/t_style.css' %}">
</head>
<body>
  <header>
    <div class="header">
      <h1>ï½FamilyNoteï½</h1>

      <form method="GET" action="{% url 'tasks:task_list' %}" class="search-bar">
        <input type="text" id="search" name="search" value="{{ search_query }}" placeholder="Noteã‚¿ã‚¤ãƒˆãƒ«ã¾ãŸã¯ãƒ¡ãƒ¢ã‚’æ¤œç´¢">
        <button type="submit">ğŸ”</button>
      </form>

      <nav class="custom-navbar">
        <a href="{% url 'tasks:home' %}">ãƒ›ãƒ¼ãƒ </a>
        <li class="dropdown">
          <a href="#" class="dropbtn">Note â–¼</a>
          <div class="dropdown-content">
            <a href="{% url 'tasks:task_list' %}">Noteä¸€è¦§</a>
            <a href="{% url 'tasks:task_create' %}">Noteç™»éŒ²</a>
          </div>
        </li>
        <li class="dropdown">
          <a href="#" class="dropbtn">ãŠãŸã‚ˆã‚Š â–¼</a>
          <div class="dropdown-content">      
            <a href="{% url 'school_letters:letter_list' %}">ãŠãŸã‚ˆã‚Šä¸€è¦§</a>
            <a href="{% url 'school_letters:create_letter' %}">ãŠãŸã‚ˆã‚Šç™»éŒ²</a>
          </div>
        </li>
        <a href="{% url 'accounts:mypage' %}">ãƒã‚¤ãƒšãƒ¼ã‚¸</a>
        {% if user.is_authenticated %}
          <form action="{% url 'accounts:logout' %}" method="post" class="logout-form">
            {% csrf_token %}
            <button type="submit" class="logout-btn">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
          </form>
        {% else %}
          <p>ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚</p>
        {% endif %}
      </nav>
    </div>
  </header>
  <main>
    <h4>{{ user.nickname }}ã•ã‚“ã€ä»Šæ—¥ã‚‚ãŠç–²ã‚Œã•ã¾ã§ã™ã€‚</h4>
    <h2>Noteï½æˆ‘ãŒå®¶ã®è¨˜éŒ²ï½</h2>
{% comment %} <button id="add_to_todolist">ãƒã‚§ãƒƒã‚¯ã—ãŸé …ç›®ã‚’<br>ToDoãƒªã‚¹ãƒˆã¸è¿½åŠ </button> {% endcomment %}

  <form method="GET" action="{% url 'tasks:task_list' %}" class="category-filter">
    <div class="filter-item">
      <label for="category">ã‚«ãƒ†ã‚´ãƒªã§çµã‚Šè¾¼ã‚€:</label>
      <select name="category" id="category" onchange="this.form.submit()">
        <option value="">ã™ã¹ã¦</option>
        {% for value, label in categories %}
          <option value="{{ value }}" {% if selected_category == value %}selected{% endif %}>
            {{ label }}
          </option>
        {% endfor %}
      </select>
    </div>

    <div class="filter-item">
      <label for="is_favorite">ãŠæ°—ã«å…¥ã‚Šã®ã¿è¡¨ç¤º</label>
      <input type="checkbox" name="is_favorite" id="id_is_favorite" {% if request.GET.is_favorite == 'on' %}checked{% endif %}>
      <button type="submit">ãƒ•ã‚£ãƒ«ã‚¿</button>
    </div>
  </form>

  <table>
    <colgroup>
      <col style="width: 30px;">  <!-- ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ -->
      <col style="width: 60px;"> <!-- æ—¥ä»˜ -->
      <col style="width: 60px;"> <!-- æ™‚é–“ -->
      <col style="width: 30px;">  <!-- ãŠæ°—ã«å…¥ã‚Š -->
      <col style="width: 150px;"> <!-- ã‚¿ã‚¤ãƒˆãƒ« -->
      <col style="width: 300px;"> <!-- ãƒ¡ãƒ¢ -->
      <col style="width: 120px;"> <!-- ç”»åƒ -->
      <col style="width: 50px;">  <!-- ç·¨é›† -->
      <col style="width: 50px;">  <!-- ã‚³ãƒ”ãƒ¼ -->
    </colgroup>
    <thead>
      <tr>
        <th></th>
        <th>æ—¥ä»˜</th>
        <th>æ™‚é–“</th>
        <th></th>
        <th>ã‚¿ã‚¤ãƒˆãƒ«</th>
        <th>ãƒ¡ãƒ¢</th>
        <th>ç”»åƒ</th>
        <th>ç·¨é›†</th>
        <th>ã‚³ãƒ”ãƒ¼</th>
      </tr>
    </thead>
    <tbody>
        {% for task in tasks %}
          <tr>
            <td class="check">
              <input type="checkbox" class="task-checkbox" value="{{ task.id }}" data-title="{{ task.title }}">
            </td>
            <td>{{ task.formatted_due_date }}</td>
            <td>
              {% if task.start_time %}
                {{ task.start_time }}
              {% else %}
                -
              {% endif %}
            </td>
            <td>
              {% if task.is_favorite %}
                  â­
              {% endif %}
            </td>
            <td>{{ task.title }}</td>
            <td class=memo>
              {% if task.memo %}
                {{ task.memo }}
              {% else %}
                -
              {% endif %}
            </td>
            <td>
              {% if task.image %}
                <img src="{{ task.image.url }}" alt="Task image" width="100">
              {% else %}
                -
              {% endif %}
            </td>
            <td class="edit">
              <a href="{% url 'tasks:task_edit' task.pk %}">ğŸ“</a>  <!-- è¿½åŠ : ç·¨é›†ãƒœã‚¿ãƒ³ -->
            </td>
            <td class="copy">
              <a href="{% url 'tasks:task_copy' task.id %}">ğŸ“„</a>
            </td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="5">ã‚¿ã‚¹ã‚¯ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</td>
          </tr>
        {% endfor %}
    </tbody>
  </table>
</form>

{% comment %} <script>
document.getElementById('add_to_todolist').addEventListener('click', function() {
  var form = document.getElementById('task_form');
    form.submit();
});
</script> {% endcomment %}


    <!-- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ -->
    <div>
      {% if tasks.has_previous %}
        <a href="?page=1">&laquo; æœ€åˆ</a>
        <a href="?page={{ tasks.previous_page_number }}">å‰ã¸</a>
      {% endif %}
        <span>ãƒšãƒ¼ã‚¸ {{ tasks.number }} / {{ tasks.paginator.num_pages }}</span>
      {% if tasks.has_next %}
        <a href="?page={{ tasks.next_page_number }}">æ¬¡ã¸</a>
        <a href="?page={{ tasks.paginator.num_pages }}">æœ€å¾Œ &raquo;</a>
      {% endif %}
    </div>

    <div class="footer-container">
      <input type="checkbox" id="select-all"> å…¨ã¦ã®é …ç›®ã‚’é¸æŠ
      <button id="delete-btn" disabled>é¸æŠã—ãŸé …ç›®ã‚’å‰Šé™¤</button>
    </div>

    <div id="delete-modal" class="modal-overlay" style="display: none;">
      <div class="modal-content">
        <span id="close-modal" class="close">&times;</span>
        <h3>ä»¥ä¸‹ã®ã‚¿ã‚¹ã‚¯ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ</h3>
        <ul id="selected-tasks-list"></ul>
        <button id="confirm-delete">å‰Šé™¤</button>
      </div>
    </div>
  </main> 
</body>
</html>

{% block extra_js %}
  <script src="{% static 'tasks/js/modal.js' %}"></script>
{% endblock %}